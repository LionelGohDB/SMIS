<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - SMIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2>Student Analytics</h2>
        <form method="POST" action="/print_analytics">
            <label for="class_filter">Select Class to Print Analytics</label>
            <select class="form-select" id="class_filter" name="class_filter">
                <option value="">All Classes</option>
                {% for class in unique_classes %}
                    <option value="{{ class }}">{{ class }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary mt-3">Print Analytics</button>
        </form>

        <form method="POST" action="/analytics">
            <div class="mb-3">
                <label for="class_filter" class="form-label">Filter by Class</label>
                <select class="form-select" id="class_filter" name="class_filter">
                    <option value="">All Classes</option>
                    {% for class in unique_classes %}
                        <option value="{{ class }}">{{ class }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="/" class="btn btn-secondary">Home</a>
        </form>

        <!-- Bootstrap grid layout -->
        <div class="row mt-4">
            <!-- Left column for Tahap Penguasaan 1 -->
            <div class="col-md-6">
                <h3>Average Scores - Tahap Penguasaan 1</h3>
                <ul class="list-group">
                    {% for class, average in average_scores_1.items() %}
                        <li class="list-group-item">
                            Class: {{ class }} - Average Tahap Penguasaan 1: {{ average | round(2) }}
                        </li>
                    {% else %}
                        <li class="list-group-item">No data available for Tahap Penguasaan 1 in the selected class.</li>
                    {% endfor %}
                </ul>

                <h3 class="mt-4">Tahap Penguasaan 1 Distribution</h3>
                <canvas id="tahapChart1" width="400" height="200"></canvas>
            </div>

            <!-- Right column for Tahap Penguasaan 2 -->
            <div class="col-md-6">
                <h3>Average Scores - Tahap Penguasaan 2</h3>
                <ul class="list-group">
                    {% for class, average in average_scores_2.items() %}
                        <li class="list-group-item">
                            Class: {{ class }} - Average Tahap Penguasaan 2: {{ average | round(2) }}
                        </li>
                    {% else %}
                        <li class="list-group-item">No data available for Tahap Penguasaan 2 in the selected class.</li>
                    {% endfor %}
                </ul>

                <h3 class="mt-4">Tahap Penguasaan 2 Distribution</h3>
                <canvas id="tahapChart2" width="400" height="200"></canvas>
            </div>
        </div>

        <a href="/" class="btn btn-primary mt-3">Home</a>
    </div>

    <script>
        // Chart for Tahap Penguasaan 1
        const tahapCounts1 = {{ tahap_counts_1 | tojson | default('{}') }};
        const labels1 = Object.keys(tahapCounts1);
        const data1 = Object.values(tahapCounts1);

        const ctx1 = document.getElementById('tahapChart1').getContext('2d');
        const tahapChart1 = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: labels1,
                datasets: [{
                    label: 'Number of Students (Tahap Penguasaan 1)',
                    data: data1,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Students'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Tahap Penguasaan 1'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return 'Count: ' + tooltipItem.raw;
                            }
                        }
                    }
                }
            }
        });

        // Chart for Tahap Penguasaan 2
        const tahapCounts2 = {{ tahap_counts_2 | tojson | default('{}') }};
        const labels2 = Object.keys(tahapCounts2);
        const data2 = Object.values(tahapCounts2);

        const ctx2 = document.getElementById('tahapChart2').getContext('2d');
        const tahapChart2 = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: labels2,
                datasets: [{
                    label: 'Number of Students (Tahap Penguasaan 2)',
                    data: data2,
                    backgroundColor: 'rgba(153, 102, 255, 0.5)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Students'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Tahap Penguasaan 2'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return 'Count: ' + tooltipItem.raw;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
